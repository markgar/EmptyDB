CREATE VIEW queryinsights.exec_requests_history AS (SELECT t1.distributed_statement_id AS distributed_statement_id, t1.TIMESTAMP AS start_time, t2.TIMESTAMP AS end_time,  DATEDIFF(MILLISECOND, t1.TIMESTAMP, t2.TIMESTAMP) AS total_elapsed_time_ms, t1.login_name, t2.row_count, t2.query_status AS status, t1.session_id, t1.connection_id, t1.program_name, t1.batch_id, t1.root_batch_id, CASE WHEN obfuscated_query_text_hash NOT LIKE '0x%[^A-Za-z1-9]' AND obfuscated_query_text_hash != '0x' THEN obfuscated_query_text_hash ELSE query_text_hash END AS query_hash, t1.statement AS command FROM queryinsights.fabric_query_starting AS t1 JOIN queryinsights.fabric_query_completed AS t2 ON t1.distributed_statement_id = t2.distributed_statement_id     AND t1.database_name = t2.database_name     AND t1.batch_id = t2.batch_id)
GO

